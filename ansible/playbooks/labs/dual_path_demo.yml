---
# ============================
# PLAY 1 – SSH / ZOAU path
# ============================
- name: Create dataset using SSH + zos_core
  hosts: zos_ssh
  gather_facts: false

  environment: "{{ zoau_env }}"

  tasks:
    - name: Show how Ansible reaches the host
      debug:
        msg: >
          Ansible is connecting via SSH to {{ ansible_host }}
          using user {{ ansible_user }}

    - name: Create a small PDS via ZOAU
      ibm.ibm_zos_core.zos_data_set:
        name: "{{ datasets.copylib }}.DEMO"
        type: pds
        state: present


# ============================
# PLAY 2 – REST / z/OSMF path
# ============================
- name: Submit a job using z/OSMF API
  hosts: zos_api
  gather_facts: false

  tasks:
    - name: Show the API endpoint being used
      debug:
        msg: >
          This play does NOT use SSH.
          It calls z/OSMF at https://{{ zosmf_host }}:{{ zosmf_port }}

    - name: Submit a simple JCL via REST
      ibm.ibm_zosmf.zosmf_job_submit:
        zosmf_host: "{{ zosmf_host }}"
        zosmf_port: "{{ zosmf_port }}"
        zosmf_user: "{{ zosmf_user }}"
        zosmf_password: "{{ zosmf_pass }}"
        src: "/some/jcl.jcl"
        location: USS
        wait: true
